<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="initial-scale=1,maximum-scale=1,user-scalable=no"
    />
    <title>Sistema de suport a la planificació</title>

    <link rel="stylesheet" href="https://js.arcgis.com/4.13/esri/themes/light/main.css" />
	<link rel="stylesheet" href="css/templatemo-style.css">
	<link rel="stylesheet" href="css/style_let.css">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.css">
	<script type="text/plain" id="arcadeB">
		var fieldsA1 = [
		  { value: $feature.a1a_c_0, alias: "a1a_c_0" },
		  { value: $feature.a1a_c_1, alias: "a1a_c_1" },
		  { value: $feature.a1a_c_2, alias: "a1a_c_2" },
		  { value: $feature.a1a_c_3, alias: "a1a_c_3" },
		  { value: $feature.a1a_o_0, alias: "a1a_o_0" },
		  { value: $feature.a1a_o_1, alias: "a1a_o_1" },
		  { value: $feature.a1a_o_2, alias: "a1a_o_2" },
		  { value: $feature.a1a_o_3, alias: "a1a_o_3" }
		];
		var fieldsA2 = [
		  { value: $feature.a1b_c_0, alias: "a1b_c_0" },
		  { value: $feature.a1b_c_1, alias: "a1b_c_1" },
		  { value: $feature.a1b_c_2, alias: "a1b_c_2" },
		  { value: $feature.a1b_c_3, alias: "a1b_c_3" },
		  { value: $feature.a1b_o_0, alias: "a1b_o_0" },
		  { value: $feature.a1b_o_1, alias: "a1b_o_1" },
		  { value: $feature.a1b_o_2, alias: "a1b_o_2" },
		  { value: $feature.a1b_o_3, alias: "a1b_o_3" }
		];
		var fieldsA3 = [
		  { value: $feature.a1c_c_0, alias: "a1c_c_0" },
		  { value: $feature.a1c_c_1, alias: "a1c_c_1" },
		  { value: $feature.a1c_c_2, alias: "a1c_c_2" },
		  { value: $feature.a1c_c_3, alias: "a1c_c_3" },
		  { value: $feature.a1c_c_0, alias: "a1c_c_0" },
		  { value: $feature.a1c_c_1, alias: "a1c_c_1" },
		  { value: $feature.a1c_c_2, alias: "a1c_c_2" },
		  { value: $feature.a1c_c_3, alias: "a1c_c_3" }
		];
		var fieldsB = [
		  { value: $feature.b1_c_0, alias: "b1_c_0" },
		  { value: $feature.b1_c_1, alias: "b1_c_1" },
		  { value: $feature.b1_c_2, alias: "b1_c_2" },
		  { value: $feature.b1_c_3, alias: "b1_c_3" },
		  { value: $feature.b1_o_0, alias: "b1_o_0" },
		  { value: $feature.b1_o_1, alias: "b1_o_1" },
		  { value: $feature.b1_o_2, alias: "b1_o_2" },
		  { value: $feature.b1_o_3, alias: "b1_o_3" }
		];
		
		var fieldsC = [
		  { value: $feature.c1_c_0, alias: "c1_c_0" },
		  { value: $feature.c1_c_1, alias: "c1_c_1" },
		  { value: $feature.c1_c_2, alias: "c1_c_2" },
		  { value: $feature.c1_c_3, alias: "c1_c_3" },
		  { value: $feature.c1_o_0, alias: "c1_o_0" },
		  { value: $feature.c1_o_1, alias: "c1_o_1" },
		  { value: $feature.c1_o_2, alias: "c1_o_2" },
		  { value: $feature.c1_o_3, alias: "c1_o_3" }
		];
		var fieldsD = [
		  { value: $feature.d1_c_0, alias: "d1_c_0" },
		  { value: $feature.d1_c_1, alias: "d1_c_1" },
		  { value: $feature.d1_c_2, alias: "d1_c_2" },
		  { value: $feature.d1_c_3, alias: "d1_c_3" },
		  { value: $feature.d1_o_0, alias: "d1_o_0" },
		  { value: $feature.d1_o_1, alias: "d1_o_1" },
		  { value: $feature.d1_o_2, alias: "d1_o_2" },
		  { value: $feature.d1_o_3, alias: "d1_o_3" }
		];
		var fieldsE1A = [
		  { value: $feature.e1a_c_0, alias: "e1a_c_0" },
		  { value: $feature.e1a_c_1, alias: "e1a_c_1" },
		  { value: $feature.e1a_c_2, alias: "e1a_c_2" },
		  { value: $feature.e1a_c_3, alias: "e1a_c_3" },
		  { value: $feature.e1a_o_0, alias: "e1a_o_0" },
		  { value: $feature.e1a_o_1, alias: "e1a_o_1" },
		  { value: $feature.e1a_o_2, alias: "e1a_o_2" },
		  { value: $feature.e1a_o_3, alias: "e1a_o_3" }
		];
		var fieldsE1B = [
		  { value: $feature.e1b_c_0, alias: "e1b_c_0" },
		  { value: $feature.e1b_c_1, alias: "e1b_c_1" },
		  { value: $feature.e1b_c_2, alias: "e1b_c_2" },
		  { value: $feature.e1b_c_3, alias: "e1b_c_3" },
		  { value: $feature.e1b_o_0, alias: "e1b_o_0" },
		  { value: $feature.e1b_o_1, alias: "e1b_o_1" },
		  { value: $feature.e1b_o_2, alias: "e1b_o_2" },
		  { value: $feature.e1b_o_3, alias: "e1b_o_3" }
		];
		var fieldsE1C = [
		  { value: $feature.e1c_c_0, alias: "e1c_c_0" },
		  { value: $feature.e1c_c_1, alias: "e1c_c_1" },
		  { value: $feature.e1c_c_2, alias: "e1c_c_2" },
		  { value: $feature.e1c_c_3, alias: "e1c_c_3" },
		  { value: $feature.e1c_o_0, alias: "e1c_o_0" },
		  { value: $feature.e1c_o_1, alias: "e1c_o_1" },
		  { value: $feature.e1c_o_2, alias: "e1c_o_2" },
		  { value: $feature.e1c_o_3, alias: "e1c_o_3" }
		];

		var fieldsF = [
		  { value: $feature.f1_c_0, alias: "f1_c_0" },
		  { value: $feature.f1_c_1, alias: "f1_c_1" },
		  { value: $feature.f1_c_2, alias: "f1_c_2" },
		  { value: $feature.f1_c_3, alias: "f1_c_3" },
		  { value: $feature.f1_o_0, alias: "f1_o_0" },
		  { value: $feature.f1_o_1, alias: "f1_o_1" },
		  { value: $feature.f1_o_2, alias: "f1_o_2" },
		  { value: $feature.f1_o_3, alias: "f1_o_3" }
		];

		function getPredominantCategory(fieldsArray,fieldsArray2){
		  var maxValue = -Infinity;
		  var maxValue2 = 0;
		  var maxCategory = "";
		  for(var k in fieldsArray){
			if(fieldsArray[k].value > maxValue){
			
			  maxValue = fieldsArray[k].value;
			  maxValue2= fieldsArray2[k].value;
			} 
		  }
		  return IIF(maxValue2 <= 0, null, maxValue2);
		}

		function getMax(fields) {
			var max = -Infinity;
			var index = -1;
			for (var i in fields) {
				if (fields[i].value > max) {
					max = fields[i].value;
					index = i;
				}
			}
			return index;
		}

		function getMin(fields) {
			var min = Infinity;
			var index = -1;
			for (var i in fields) {
				if (fields[i].value < min) {
					min = fields[i].value;
					index = i;
				}
			}
			return index;
		}

		var listFields = [fieldsA1, fieldsA2, fieldsA3, fieldsB, fieldsC, fieldsD, fieldsE1A, fieldsE1B, fieldsE1C, fieldsF];
		var typeOpt = ["max", "min", "min", "max", "max", "min", "max", "max", "max", "max"];

		/*
		function getSameValues(fields, index) {
			var listFields = [];
			for (var i in fields) {
				if (fields[index].value == fields[i].value) {
					listFields.push(i);
				}
			}
			return listFields;
		}

		function getValueByDimention2(fieldsSelected, fields, opt) {
			var scenario = 0;
			if (opt == "max") {
				scenario = getMax(fields);
			}
			if (opt == "min") {
				scenario = getMin(fields);
			}
			var scenarios = getSameValues(fields, scenario);
			var value = 0;
			for (var i in scenarios) {
				value += fieldsSelected[scenarios[i]].value;
			}

			return (value / scenarios.length);
		}
		*/

		function getValueByDimention(fieldsSelected, fields, opt) {
			var scenario = 0;
			if (opt == "max") {
				scenario = getMax(fields);
			}
			if (opt == "min") {
				scenario = getMin(fields);
			}

			return fieldsSelected[scenario].value;
		}

		function getValue(fieldsSelected, weightListIndicators) {
			var value = 0;
			for (var i in weightListIndicators) {
				value += getValueByDimention(fieldsSelected, listFields[i], typeOpt[i]) * weightListIndicators[i];
			}
			return value;
		}

		/*
		function getValue(fields, weightListIndicators) {
			return (fields[getMax(fieldsA1)].value * weightListIndicators[0])
				+ (fields[getMin(fieldsA2)].value * weightListIndicators[1])
				+ (fields[getMin(fieldsA3)].value * weightListIndicators[2]) 
				+ (fields[getMax(fieldsB)].value * weightListIndicators[3]) 
				+ (fields[getMax(fieldsC)].value * weightListIndicators[4]) 
				+ (fields[getMin(fieldsD)].value * weightListIndicators[5]) 
				+ (fields[getMax(fieldsE1A)].value * weightListIndicators[6]) 
				+ (fields[getMax(fieldsE1B)].value * weightListIndicators[7]) 
				+ (fields[getMax(fieldsE1C)].value * weightListIndicators[8]) 
				+ (fields[getMax(fieldsF)].value * weightListIndicators[9]);
		}*/
		
	</script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <script src="https://js.arcgis.com/4.13/"></script>

    <style>
      html,
      body,
      .viewMap {
        padding: 0;
        margin: 0;
        height: 99%;
        width: 99%;
		color:black;
		font-family: "Avenir Next W00","Helvetica Neue",Helvetica,Arial,sans-serif;
      }

	  #infoDiv,#escenariDiv, .title-map-dif {
        padding: 8px;
      }
	  #divTop{
		padding: 12px;
		font-size: 12px;
		color: #323232;
	  }
	  #divMainMap {
		padding: 0;
        margin: 0;
        height: 60%;
        width: 75%;
		float:left;
		border-color: coral;
	  }
	  #control-panel {
		padding: 0;
        margin: 0;
        height: 60%;
        width: 25%;
		float:left;
		border-color: coral;
	  }
	  .divgrafics, .mapSmallBox{
        padding: 0;
        margin: 0;
        height: 41%;
        width: 50%;
		float:left;
		border-color: coral;
      }
	  #descripcio {
		width:100%;
		border: none;
		font-size: 12px;
		font-family:"Arial";
		margin:5px 0;
	  }
	.pane {
		position: fixed;
		top: 0; left: 0; bottom: 0; right: 0;
		margin: auto;
		width: 820px;
		height: 500px;
		z-index: 1 !important;
		background: #f0f0fd;
		background: rgba(240,240,253,0.90);
		padding: 22px 32px;
		-moz-border-radius: 8px;
		-webkit-border-radius: 8px;
		border-radius: 8px;
		-moz-box-shadow: 0 0 18px rgba(0, 0, 0, 0.9);
		-webkit-box-shadow: 0 0 18px rgba(0, 0, 0, 0.9);
		-box-shadow: 0 0 18px rgba(0, 0, 0, 0.9);
	}
	
	
	.button {
		box-shadow:inset 0px 1px 3px 0px #91b8b3;
		background:linear-gradient(to bottom, #c00000 5%, #c43b3b 100%);
		background-color:#c00000;
		border-radius:5px;
		display:inline-block;
		cursor:pointer;
		color: white !important;
		text-align: center;
		font-family: "Avenir Next W00","Helvetica Neue",Helvetica,Arial,sans-serif;
		font-size:12px;
		margin: 7px 2px;
		padding: 7px 5px ;
		text-decoration:none;
		text-shadow:0px -1px 0px #2b665e;
		width: 90%;
		border:0;
			}
	.button:hover {
		background:linear-gradient(to bottom, #c43b3b 5%, #c00000 100%);
		background-color:#c43b3b;
	}
	.button:active {
		position:relative;
		top:1px;
	}

	.label {
            width:40%;
            display:inline;
            float:left;
        }

	.formRange input {
		width:50%;
	}

	.resultRange {
		padding-left:15px;
		text-align:center;
	}

	.formRange {
		padding:5px;
		display:flex;
	}

	.formRangeTotal {
		text-align: center;
		font-weight: bold;
	}

	.subtitle_dim {
		color:#c00000;
		width: 40%;
		float:left;
	}

	.subtitle_range {
		color:#c00000;
		width: 50%;
	}
	
    </style>

<script src="js/indicators/MaxSumMultipleIndicator.js"></script>
<script src="js/indicators/MinSumIndicator.js"></script>
<script src="js/indicators/MinSumMultipleIndicator.js"></script>
<script src="js/indicators/MaxAvgIndicator.js"></script>
<script src="js/indicators/MaxSumIndicator.js"></script>
<script src="js/indicadors.js"></script>
<script src="js/indica.js"></script>

  </head>

  <body style="font-family: 'Avenir Next W00','Helvetica Neue',Helvetica,Arial,sans-serif;" onload="canvi(valuesRanges());">
   	<div id="divMainMap">
    	<div id="viewDiv" class="viewMap"></div>
	</div>
	<div id="control-panel">
		<h3>Configuració</h3>
		<div>
			<div class="formRange"><div class="label"><label for="ARange">Eficiència energètica</label></div><input type="range" name="A1Range" id="A1Range" min="0" max="100" step="1" onchange="showVal('A1RangeValue', this.value)" oninput="showVal('A1RangeValue', this.value)"><span class="resultRange" id="A1RangeValue"></span></div>
			<div class="formRange"><div class="label"><label for="ARange">Consum d’aigua</label></div><input type="range" name="A2Range" id="A2Range" min="0" max="100" step="1" onchange="showVal('A2RangeValue', this.value)" oninput="showVal('A2RangeValue', this.value)"><span class="resultRange" id="A2RangeValue"></span></div>
			<div class="formRange"><div class="label"><label for="ARange">Apropiació de biomassa</label></div><input type="range" name="A3Range" id="A3Range" min="0" max="100" step="1" onchange="showVal('A3RangeValue', this.value)" oninput="showVal('A3RangeValue', this.value)"><span class="resultRange" id="A3RangeValue"></span></div>
			<div class="formRange"><div class="label"><label for="BRange">Conservació de la biodiversitat</label></div><input type="range" name="BRange" id="BRange" min="0" max="100" step="1" onchange="showVal('BRangeValue', this.value)" oninput="showVal('BRangeValue',this.value)"><span class="resultRange" id="BRangeValue"></span></div>
			<div class="formRange"><div class="label"><label for="CRange">Funcionament del paisatge</label></div><input type="range" name="CRange" id="CRange" min="0" max="100" step="1" onchange="showVal('CRangeValue', this.value)" oninput="showVal('CRangeValue', this.value)"><span class="resultRange" id="CRangeValue"></span></div>
			<div class="formRange"><div class="label"><label for="DRange">Canvi climàtic</label></div><input type="range" name="DRange" id="DRange" min="0" max="100" step="1" onchange="showVal('DRangeValue', this.value)" oninput="showVal('DRangeValue', this.value)"><span class="resultRange" id="DRangeValue"></span></div>
			<div class="formRange"><div class="label"><label for="E1ARange">Recirculació de nutrients</label></div><input type="range" name="E1ARange" id="E1ARange" min="0" max="100" step="1" onchange="showVal('E1ARangeValue', this.value)" oninput="showVal('E1ARangeValue', this.value)"><span class="resultRange" id="E1ARangeValue"></span></div>
			<div class="formRange"><div class="label"><label for="E1BRange">Estoc de carboni</label></div><input type="range" name="E1BRange" id="E1BRange" min="0" max="100" step="1" onchange="showVal('E1BRangeValue', this.value)" oninput="showVal('E1BRangeValue', this.value)"><span class="resultRange" id="E1BRangeValue"></span></div>
			<div class="formRange"><div class="label"><label for="E1CRange">Producció agrícola</label></div><input type="range" name="E1CRange" id="E1CRange" min="0" max="100" step="1" onchange="showVal('E1CRangeValue', this.value)" oninput="showVal('E1CRangeValue', this.value)"><span class="resultRange" id="E1CRangeValue"></span></div>
			<div class="formRange"><div class="label"><label for="FRange">Llocs de treball</label></div><input type="range" name="FRange" id="FRange" min="0" max="100" step="1" onchange="showVal('FRangeValue', this.value)" oninput="showVal('FRangeValue', this.value)"><span class="resultRange" id="FRangeValue"></span></div>
			<div class="formRange formRangeTotal">Total: <span id="TotalRanges"></span> / 100 </div>  
			<button class="button" id="buttonAplicar" style="float: right;width:15%;" onclick="if(checkRanges()) { canvi(valuesRanges())} else { alert('La suma dels pesos ha de ser exactament 100'); }">Aplicar</button>
		</div>
		<div>
			<div id="escenariDiv" class="esri-widget">
				Escenari Optimitzat<br>
				<select id="field-select-ind" class="esri-widget" onchange="canvi(valuesRanges())">
					<option value="A1" selected>Eficiència energètica</option>
					<option value="A2">Consum d’aigua</option>
					<option value="A3">Apropiació de biomassa</option>
					<option value="B">Conservació de la biodiversitat</option>
					<option value="C">Funcionament del paisatge</option>
					<option value="D">Canvi climàtic</option>
					<option value="E1A">Recirculació de nutrients</option>
					<option value="E1B">Estoc de carboni</option>
					<option value="E1C">Producció agrícola</option>
					<option value="F">Llocs de treball</option>
				</select>
			</div>
		</div>
	</div>
	<div id="divMapActual" class="mapSmallBox">
		<div id="viewDivActual"  class="viewMap"></div>
	</div>
	<div id="divMapDifActual" class="mapSmallBox">
		<div id="viewDivDifActual"  class="viewMap"></div>
		<div id="escenariDif" class="esri-widget title-map-dif">
			Diferència actual
		</div>
	</div>
	<div id="divMapTendencial" class="mapSmallBox">
		<div id="viewDivTendencial"  class="viewMap"></div>
	</div>
	<div id="divMapDiftendencial" class="mapSmallBox">
		<div id="viewDivDifTendencial"  class="viewMap"></div>
		<div id="escenariDifTendencial" class="esri-widget title-map-dif">
			Diferència tendencial
		</div>
	</div>
	<div class="divgrafics" id="radarGrafic">
		<canvas class="divgrafics" id="marksChart"></canvas>
	</div>	
	<div class="divgrafics" id="histogramGrafic">
		<canvas class="divgrafics" id="histoChart"></canvas>
	</div>
  </body>
  <script>
	function showVal(tag, newVal)
    {
		var range = tag.substr(0, tag.length - 5);
		let maxPuntuation = 100;
		var total = getTotalValues();
		if (total > maxPuntuation) {
			alert("La puntuació no pot ser més gran de 100.");
			document.getElementById(range).value = maxPuntuation - (total - document.getElementById(range).value)
		} else {
			document.getElementById(tag).innerHTML=newVal;
        	updateTotalRanges();
		}
    }

    function iniValues(ranges) 
    {
        ranges.forEach(iniVal);
        updateTotalRanges();
    }

    function iniVal(range) 
    {
        document.getElementById(range + "Value").innerHTML = 10;
        document.getElementById(range).value = 10;
    }

    function updateTotalRanges() 
    {
        var total = 0;
        for (x in ranges) {
            total += parseInt(document.getElementById(ranges[x]).value);
        }
		document.getElementById("TotalRanges").innerHTML = total;
		/*if (!checkRanges()) {
			document.getElementById("TotalRanges").style.color = "#ff0000";
		} else {
			document.getElementById("TotalRanges").style.color = "#00ff00";
		}*/
    }

	function getTotalValues()
    {
        var total = 0;
        for (x in ranges) {
            total += parseInt(document.getElementById(ranges[x]).value);
        }
		return total;
	}

    function checkRanges()
    {
        var total = 0;
        for (x in ranges) {
            total += parseInt(document.getElementById(ranges[x]).value);
        }
		return total == sumTotalRanges;
	}
	
	function valuesRanges()
	{
		valuesRangesList = [];
		for (x in ranges) {
			valuesRangesList.push(parseFloat(document.getElementById(ranges[x]).value)/100);
		}
		return valuesRangesList;
	}

	var iniElemet = 10;
    var sumTotalRanges = 100;

    var ranges = ["A1Range", "A2Range", "A3Range", "BRange", "CRange", "DRange", "E1ARange", "E1BRange", "E1CRange", "FRange"];

    iniValues(ranges);
  </script>
</html>
